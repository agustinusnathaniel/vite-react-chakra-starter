# AI Agent Guidance

This document provides a mental model of the system architecture for AI IDE agents (Cursor, Antigravity, Zed, Windsurf) to reason accurately about structure, intent, and safe changes.

## Mental Model

This is a **starter template** for React applications. The codebase is intentionally minimal and serves as a foundation that developers extend. The architecture follows a clear separation of concerns with file-based routing, component composition, and centralized configuration.

### Core Architecture Principles

1. **File-based routing**: Routes are files, not configuration
2. **Component composition**: Small, focused components compose into pages
3. **Type safety**: TypeScript enforces contracts at build time
4. **Convention over configuration**: Patterns are established, not configured
5. **Minimal dependencies**: Only essential dependencies included

## Module Responsibility Mapping

### Entry and Bootstrap (`src/main.tsx`)

**Responsibility**: Application initialization and provider setup

**Structure**:
```tsx
Provider (Chakra UI) 
  ‚Üí QueryClientProvider 
    ‚Üí RouterProvider 
      ‚Üí Route Tree
```

**Safe to modify**: 
- Provider order (must maintain: Chakra ‚Üí Query ‚Üí Router)
- Router configuration options (preload, scroll restoration, etc.)
- Default components (pending, not found)

**Risky to modify**:
- Provider nesting order (breaks context access)
- Router context structure (breaks type safety)

**Dependencies**: 
- `@/lib/components/ui/provider` - Chakra theme provider
- `@/lib/services/constants` - Query client instance
- `./routeTree.gen` - Auto-generated route tree

### Routing Layer (`src/routes/`)

**Responsibility**: Route definitions and route-level configuration

**Key Files**:
- `__root.tsx`: Root layout route with meta tags and devtools
- `index.tsx`: Home page route
- `routeTree.gen.ts`: **DO NOT EDIT** - Auto-generated by plugin

**Safe to modify**:
- Adding new route files (follow naming: `route-name.tsx`)
- Route component assignments
- Route-level meta tags (in `__root.tsx`)

**Risky to modify**:
- `routeTree.gen.ts` (regenerates on save, manual edits lost)
- Route file naming patterns (affects URL structure)
- `__root.tsx` structure (breaks layout for all routes)

**Pattern**:
```tsx
import { createFileRoute } from '@tanstack/react-router';
import { PageComponent } from '@/lib/pages/page-name';

export const Route = createFileRoute('/path')({
  component: PageComponent,
});
```

### Layout System (`src/lib/layout/`)

**Responsibility**: Application-wide layout structure

**Components**:
- `index.tsx`: Main layout wrapper (Header, Footer, content area)
- `components/header.tsx`: Top navigation/header
- `components/footer.tsx`: Bottom footer
- `components/meta.tsx`: HTML meta tags component

**Safe to modify**:
- Layout structure (spacing, max-width, etc.)
- Header/Footer content
- Meta tag values

**Risky to modify**:
- Layout component signature (used by `__root.tsx`)
- Removing Header/Footer (breaks layout contract)

**Invariant**: All routes render through `Layout` component via `__root.tsx`.

### UI Components (`src/lib/components/ui/`)

**Responsibility**: Reusable, base-level UI components

**Components**:
- `provider.tsx`: Chakra UI provider wrapper with theme
- `color-mode.tsx`: Color mode (light/dark) management
- `button.tsx`: Enhanced button with loading state

**Safe to modify**:
- Component implementations
- Adding new UI components
- Extending component props

**Risky to modify**:
- `provider.tsx` structure (breaks app initialization)
- `color-mode.tsx` API (used throughout app)
- Component export names (breaking changes for consumers)

**Note**: These components are excluded from Biome linting (see `biome.json`). They may use patterns not allowed elsewhere.

### Pages (`src/lib/pages/`)

**Responsibility**: Page-level components and page-specific sub-components

**Structure**:
```
pages/
  home/
    index.tsx          # Page component
    components/         # Page-specific components
      cta-section.tsx
      some-text.tsx
      some-image.tsx
  404/
    index.tsx          # Error page
```

**Safe to modify**:
- Page component implementations
- Adding new pages
- Page-specific component structure
- Component composition within pages

**Risky to modify**:
- Page component exports (must match route imports)
- Default export pattern (required for route files)

**Pattern**: Pages use default exports and compose smaller components.

### Services (`src/lib/services/`)

**Responsibility**: Shared services, clients, and constants

**Current Files**:
- `constants.ts`: QueryClient instance

**Safe to modify**:
- Adding new service files
- QueryClient configuration
- Shared constants

**Risky to modify**:
- QueryClient instantiation pattern (used in `main.tsx`)
- Export names (breaking for imports)

### Theme System (`src/lib/styles/theme/`)

**Responsibility**: Chakra UI theme configuration

**File**: `index.ts` - Theme creation using `createSystem`

**Safe to modify**:
- Theme tokens (colors, fonts, spacing)
- Design system values
- Theme extensions

**Risky to modify**:
- Theme export structure (must match Chakra Provider expectations)
- Removing default config (breaks base theme)

**Invariant**: Theme must be provided via `Provider` component at root.

### Utilities (`src/lib/utils/`)

**Responsibility**: Pure utility functions

**Safe to modify**:
- Function implementations
- Adding new utilities
- Test files

**Note**: Only utilities are included in test coverage configuration.

## Safe vs Risky Areas

### ‚úÖ Safe to Modify

1. **Page components** (`src/lib/pages/**/index.tsx`): Implementation changes, adding components
2. **Layout content** (`src/lib/layout/components/`): Header/Footer content, styling
3. **Route files** (new routes): Adding new `src/routes/*.tsx` files
4. **Theme tokens** (`src/lib/styles/theme/index.ts`): Design system values
5. **Utilities** (`src/lib/utils/`): Pure functions
6. **Page sub-components**: Components within `pages/*/components/`

### ‚ö†Ô∏è Risky to Modify

1. **`routeTree.gen.ts`**: Auto-generated, edits are lost
2. **Provider nesting** (`src/main.tsx`): Breaks context access
3. **`__root.tsx` structure**: Breaks layout for all routes
4. **Route file naming**: Affects URL structure
5. **Path alias configuration** (`tsconfig.json` paths): Breaks imports
6. **Build configuration** (`vite.config.ts`): Can break builds
7. **Type definitions**: Breaking changes for consumers

### üö´ Do Not Modify

1. **`routeTree.gen.ts`**: Regenerates automatically
2. **`node_modules/`**: Managed by package manager
3. **Build artifacts** (`build/`): Generated files
4. **Lock files** (`pnpm-lock.yaml`): Managed by pnpm

## How Agents Should Reason About Refactors

### Adding New Features

1. **New Route**:
   - Create file in `src/routes/` with `createFileRoute`
   - Create page component in `src/lib/pages/`
   - Route tree auto-generates

2. **New UI Component**:
   - Add to `src/lib/components/ui/` or appropriate subdirectory
   - Use Chakra UI primitives
   - Export as named export (unless it's a page component)
   - Follow existing patterns (forwardRef for DOM components)

3. **New Page**:
   - Create directory in `src/lib/pages/`
   - Create `index.tsx` with default export
   - Add page-specific components in `components/` subdirectory
   - Import in route file

4. **Theme Customization**:
   - Modify `src/lib/styles/theme/index.ts`
   - Add/update theme tokens
   - Changes apply globally via Provider

### Refactoring Patterns

1. **Moving Components**:
   - Update imports (use path aliases `@/*`)
   - Check route imports if moving page components
   - Verify Biome exclusions if moving UI components

2. **Renaming Files**:
   - Update all imports
   - For routes: URL path changes
   - For pages: Update route file imports
   - Run `pnpm type:check` to catch missed imports

3. **Splitting Components**:
   - Create new component file
   - Export from new file
   - Update imports in consuming components
   - Maintain component API (props interface)

### Breaking Changes

When making breaking changes:

1. **Component Props**: Update all usages, check route files
2. **Export Names**: Search codebase for imports
3. **File Locations**: Update path alias imports
4. **Route Paths**: Update any hardcoded navigation
5. **Theme Tokens**: Update components using removed tokens

**Tool**: Use `pnpm knip` to find unused code and `pnpm type:check` to find type errors.

## Adding Features Without Breaking Invariants

### Invariant: All Routes Render Through Layout

**To maintain**: Never bypass `__root.tsx` ‚Üí `Layout` structure. New routes automatically inherit layout.

**Example - Adding a new route**:
```tsx
// src/routes/about.tsx
import { createFileRoute } from '@tanstack/react-router';
import AboutPage from '@/lib/pages/about';

export const Route = createFileRoute('/about')({
  component: AboutPage, // Automatically wrapped in Layout via __root.tsx
});
```

### Invariant: Single QueryClient Instance

**To maintain**: Always import `queryClient` from `@/lib/services/constants`, never create new instances.

**Example - Using React Query**:
```tsx
import { useQuery } from '@tanstack/react-query';
import { queryClient } from '@/lib/services/constants'; // Use shared instance

// In component
const { data } = useQuery({
  queryKey: ['key'],
  queryFn: fetchData,
});
```

### Invariant: Theme Provided at Root

**To maintain**: Never create new ChakraProvider instances. Use theme from `@/lib/styles/theme`.

**Example - Theming components**:
```tsx
import { Box } from '@chakra-ui/react';
// Theme automatically available via Provider in main.tsx

export const Component = () => (
  <Box color="blue.500"> {/* Uses theme tokens */}
    Content
  </Box>
);
```

### Invariant: Path Aliases for src/ Imports

**To maintain**: Always use `@/*` for imports from `src/`, never relative paths.

**Example**:
```tsx
// ‚úÖ Correct
import { Button } from '@/lib/components/ui/button';

// ‚ùå Incorrect
import { Button } from '../../../lib/components/ui/button';
```

## Files That Should Rarely Be Modified

1. **`src/main.tsx`**: Core bootstrap, only modify for provider changes
2. **`src/routes/__root.tsx`**: Root layout, modify only for meta tags or devtools
3. **`src/lib/components/ui/provider.tsx`**: Theme provider structure
4. **`vite.config.ts`**: Build configuration, modify only for plugin changes
5. **`tsconfig.json`**: TypeScript config, modify only for path changes
6. **`biome.json`**: Linting rules, modify only for rule changes

## Navigation Hints for Large Areas

### Finding Route Definitions

- Routes: `src/routes/*.tsx`
- Route tree: `src/routeTree.gen.ts` (read-only reference)
- Route plugin config: `vite.config.ts` (tanstackRouter plugin)

### Finding Component Usage

- Search for import: `grep -r "from '@/lib/components/ui/button'"`
- Check route files for page imports
- Check layout for shared components

### Understanding Theme Structure

- Theme config: `src/lib/styles/theme/index.ts`
- Theme usage: Search for Chakra UI component props (e.g., `color="blue.500"`)
- Theme provider: `src/lib/components/ui/provider.tsx`

### Tracing Data Flow

1. Route ‚Üí Page component (in route file)
2. Page ‚Üí Sub-components (in page directory)
3. Components ‚Üí Chakra primitives (imported from `@chakra-ui/react`)
4. Query ‚Üí Components (via `useQuery` hook)

## Known Pitfalls for Automated Edits

### 1. Route Tree Regeneration

**Pitfall**: Editing `routeTree.gen.ts` manually

**Why**: File regenerates on save, manual edits are lost

**Solution**: Only edit route files in `src/routes/`, never the generated tree

### 2. Path Alias in Config Files

**Pitfall**: Using `@/*` aliases in `vite.config.ts` or `vitest.config.ts`

**Why**: Path aliases only work in TypeScript source files, not config files

**Solution**: Use relative paths in config files

### 3. Default vs Named Exports

**Pitfall**: Using wrong export style for components

**Why**: Biome enforces rules, routes/pages need default exports

**Solution**: 
- Routes/pages: default export
- All other components: named export

### 4. Color Mode Hydration

**Pitfall**: Accessing color mode during SSR without `ClientOnly`

**Why**: Theme resolution happens client-side, causes hydration mismatch

**Solution**: Wrap color-mode-dependent UI in `ClientOnly` component

### 5. QueryClient Duplication

**Pitfall**: Creating new QueryClient instances

**Why**: Breaks caching and state management

**Solution**: Always import from `@/lib/services/constants`

### 6. Biome Exclusions

**Pitfall**: Applying Biome rules to excluded files

**Why**: UI components and generated files are excluded

**Solution**: Check `biome.json` `files.includes` before applying fixes

## AI IDE Specific Notes

### Cursor

- **Context**: Cursor has good TypeScript understanding. Use type information to infer component relationships.
- **Suggestions**: When suggesting imports, prefer path aliases (`@/*`) over relative paths.
- **Refactoring**: Use "Find References" to trace component usage before renaming.

### Antigravity

- **File Navigation**: Use file tree structure to understand component hierarchy.
- **Code Generation**: Follow existing patterns (forwardRef, named exports, etc.) when generating code.

### Zed

- **Multi-file Editing**: When editing related files (route + page), ensure exports match.
- **Search**: Use project-wide search to find all usages before making breaking changes.

### Windsurf

- **Context Awareness**: Understand that `routeTree.gen.ts` is generated and should not be edited.
- **Pattern Recognition**: Follow established patterns (file naming, export styles) when suggesting code.

## Suggested Prompts for Agents

When working with this codebase, agents should:

1. **Before adding routes**: "Check existing route patterns in `src/routes/` and follow the `createFileRoute` pattern"

2. **Before modifying providers**: "Verify provider nesting order in `src/main.tsx` - Chakra ‚Üí Query ‚Üí Router"

3. **Before renaming files**: "Search codebase for all imports of this file using path aliases"

4. **Before adding components**: "Check if similar component exists in `src/lib/components/ui/` or page-specific `components/` directory"

5. **Before modifying theme**: "Review theme structure in `src/lib/styles/theme/index.ts` and Chakra UI v3 documentation"

6. **Before refactoring**: "Run `pnpm type:check` and `pnpm knip` to identify dependencies and unused code"

## Testing Considerations for Agents

- **Test Location**: Co-locate tests with source files (`*.test.ts` next to `*.ts`)
- **Coverage Scope**: Only `src/lib/utils/` is included in coverage by default
- **Test Patterns**: Use Vitest, follow existing test structure in `sample.test.ts`
- **Running Tests**: Use `pnpm test` for CI, `pnpm test:ui` for interactive debugging

## Summary Checklist for Agents

Before making changes, verify:

- [ ] Understand which module owns the code being modified
- [ ] Check if file is auto-generated (don't edit `routeTree.gen.ts`)
- [ ] Verify export style matches file type (default for routes/pages, named for others)
- [ ] Use path aliases (`@/*`) for `src/` imports
- [ ] Maintain provider nesting order if modifying `main.tsx`
- [ ] Check Biome exclusions if modifying UI components
- [ ] Run type check after changes: `pnpm type:check`
- [ ] Verify route tree regenerates correctly after route changes

